
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>mpl-qtthread Documentation &#8212; mpl-qtthread 0.1.0.dev1+g68ebb73 documentation</title>
    
    <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/style.css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    
    <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="API" href="api.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="#">
  <img src="_static/images/logo2.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        
<ul id="navbar-main-elements" class="navbar-nav">
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/plot_types/index">Plot types</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/gallery/index">Examples</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/tutorials/index">Tutorials</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/api/index">Reference</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/users/index">Usage guide</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/devel/index">Develop</a>
  </li>
  <li class="nav-item">
    <a class="reference internal nav-link" href="https://matplotlib.org/stable/users/release_notes">Release notes</a>
  </li>
</ul>

      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        
      <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://gitter.im/matplotlib" rel="noopener" target="_blank" title="gitter">
            <span><i class="fab fa-gitter"></i></span>
            <label class="sr-only">gitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://discourse.matplotlib.org" rel="noopener" target="_blank" title="discourse">
            <span><i class="fab fa-discourse"></i></span>
            <label class="sr-only">discourse</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/matplotlib/matplotlib" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/matplotlib/" rel="noopener" target="_blank" title="twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="api.html"
                          title="next chapter">API</a></p>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#theory-of-operation">
   Theory of operation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#python-threads">
     Python Threads
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="mpl-qtthread-documentation">
<h1>mpl-qtthread Documentation<a class="headerlink" href="#mpl-qtthread-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="_as_gen/mpl_qtthread.initialize_qt_teleporter.html">mpl_qtthread.initialize_qt_teleporter</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="release_history.html">Release History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="release_history.html#v0-0-1-2022-01-29">v0.0.1 (2022-01-29)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="min_versions.html">Minimum Version of Python and NumPy</a></li>
</ul>
</div>
<section id="theory-of-operation">
<h2>Theory of operation<a class="headerlink" href="#theory-of-operation" title="Permalink to this headline">¶</a></h2>
<p>When working with Qt and threads you have to be sure to create QObjects on the
thread you are going to use them on and you can only draw to the screen from
the main thread.  Combined, this means that all of the UI creation and work
needs to be done on the main thread.  However, background threads are able to
influence the UI via Qt’s Signal/Slot mechanism which can be safely used for
inter-thread communication.</p>
<p>However, when you use the function is <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.pyplot.html#module-matplotlib.pyplot" title="(in Matplotlib v3.5.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">matplotlib.pyplot</span></code></a> to make new
Matplotlib figures it will create a <code class="docutils literal notranslate"><span class="pre">QtWidget</span></code> subclass instance for the
canvas and a <code class="docutils literal notranslate"><span class="pre">MainWindow</span></code> instance to put the canvas and toolbar in.  Thus,
if you try to use pyplot from any Python thread but the main thread you can run
into significant issue from Qt (never mind that the rest of Matplotlib is not
very thread safe) ranging from windows that never render to crashes.</p>
<p>This works by creating a <code class="docutils literal notranslate"><span class="pre">QtCore.QObject</span></code> on the main thread (manually done
via <a class="reference internal" href="_as_gen/mpl_qtthread.initialize_qt_teleporter.html#mpl_qtthread.initialize_qt_teleporter" title="mpl_qtthread.initialize_qt_teleporter"><code class="xref py py-obj docutils literal notranslate"><span class="pre">mpl_qtthread.initialize_qt_teleporter</span></code></a>).  This object has two signals, one
for creating the <a class="reference external" href="https://matplotlib.org/stable/api/backend_bases_api.html#matplotlib.backend_bases.FigureCanvasBase" title="(in Matplotlib v3.5.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FigureCanvasBase</span></code></a> instance and one for
creating the <a class="reference external" href="https://matplotlib.org/stable/api/backend_bases_api.html#matplotlib.backend_bases.FigureManagerBase" title="(in Matplotlib v3.5.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">FigureManagerBase</span></code></a> that we need.  As part of
creating this (private) object Slots (aka callbacks) are connected to the
Signals that will do the actual work of creating the instances.</p>
<p>These Signals are used by the Matplotlib Backend that the package implements.
The main thing than is over-ridden from the upstream behavior is that rather
than directly instantiating the <code class="docutils literal notranslate"><span class="pre">FigureCanvas</span></code> and <code class="docutils literal notranslate"><span class="pre">FigureManager</span></code>
instances, it emits enough information to create them to the Signals.  Because
the callbacks for a Signal are processed on the thread the QObject is
affiliated with (and they are by default affiliated with the thread they are
created on) the callbacks to create the QWidgets will run on the main thread.
Thus, we are able to create and update Matplotlib figures from a background
thread while the QApplication runs in the main thread.</p>
<p>Matplotlib still is not actually thread safe so it is important to only update
the Figure from one thread.  If you are extensively panning or zooming while
the background thread is simultaneously updating Figure, it is very likely that
you will suffer race conditions.  Many of these issues should be render
failures due to a temporarily inconsistent Figure state (e.g. updating the x
and y values of a <a class="reference external" href="https://matplotlib.org/stable/api/_as_gen/matplotlib.lines.Line2D.html#matplotlib.lines.Line2D" title="(in Matplotlib v3.5.1)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Line2D</span></code></a> object to be different
lengths). It is possible that this package will need to develop a way to add
some locking to Matplotilb.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<section id="python-threads">
<h3>Python Threads<a class="headerlink" href="#python-threads" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">mpl_qtthread.backend</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.backends.backend_qt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># set up the teleporter</span>
<span class="n">mpl_qtthread</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">initialize_qt_teleporter</span><span class="p">()</span>
<span class="c1"># tell Matplotlib to use this backend</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;module://mpl_qtthread.backend_agg&quot;</span><span class="p">)</span>

<span class="c1"># import pyplot and make it interactive</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

<span class="c1"># suppress (now) spurious warnings for mpl3.3+</span>
<span class="n">mpl_qtthread</span><span class="o">.</span><span class="n">monkeypatch_pyplot</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">background</span><span class="p">():</span>
    <span class="c1"># make a figure and plot some data</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="p">(</span><span class="n">ln</span><span class="p">,)</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
    <span class="c1"># periodically update the figure</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;starting to block </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ln</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cycle </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>


<span class="c1"># start the thread</span>
<span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">background</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="c1"># start the QApplication main loop</span>
<span class="n">matplotlib</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">backend_qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">exec</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
</section>


              </div>
              
              
          </main>
          

      </div>
    </div>
  
    <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Brookhaven National Laboratory.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>